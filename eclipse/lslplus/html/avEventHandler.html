<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">

<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
	<title>Avatar Event Handler</title>
	<link rel="stylesheet" type="text/css" href="book.css"/>
</head>

<body>
<h1>Avatar Event Handler</h1>

<p>An Avatar Event Handler is a user created module that can be associated with an avatar in a 
<a href="sim-project.html">Sim Project</a>.  The avatar event handler contains various functions which
will be triggered when certain events happen within the simulator; the handler can in turn generate
its own events in response using the built-in <a href="avEventGen.html">Avatar Event Generator Module</a>.
An avatar event handler is useful for testing interactions of avatars with your LSL scripts (i.e. what 
happens when an avatar touches my prim? What happens when an avatar pays my prim?  What happens when a 
prim has taken the controls of a particular avatar and the avatar changes its control bits?).</>

<p>An Avatar Event Handler can respond to the following simulator events:</p>
<table>
<tr><th>Event</th><th>Event Handler Entry Point</th><th>Notes</th></tr>
<tr>
<td>&quot;Owner Say&quot;</td>
<td>list <em>onOwnerSay</em>(string key, string message)</td>
<td>Triggered when a script in a prim owned by the avatar calls <em>llOwnerSay</em></td>
</tr>
<tr>
<td>&quot;Chat&quot;</td>
<td>list <em>onChat</em>(string name, string key, string message)</td>
<td>Triggered when any public (channel 0) chat occurs within range of the avatar.</td>
</tr>
<tr>
<td>&quot;Load URL&quot;</td>
<td>list <em>onLoadURL</em>(string message, string url)</td>
<td>When <em>llLoadURL</em> is called for the avatar/agent.</td>
</tr>
<tr>
<td>&quot;Dialog&quot;</td>
<td>list <em>onDialog</em>(string message, list buttons, integer chan, string source)</td>
<td>Triggered when <em>llDialog</em> is called.</td>
</tr>
<tr>
<td>&quot;Map Destination&quot;</td>
<td>list <em>onMapDestination</em>(string simName, vector position)</td>
<td>Triggered when <em>llMapDestination</em> is called.</td>
</tr>
</table>

<p>
An event handler entry point returns a <em>list</em> of <em>string</em> values, each value representing 
a new event to trigger.  For example, an event handler could decide to cause the avatar to touch a prim
an shout a message when it hears a particular 'llOwnerSay' message from one of the prims the avatar owns.
To generate the event list, the event handler must import the 
<a href="avEventGen.html">Avatar Event Generator Module</a> and call the event generation routines from 
that module.  For example:

<code>
<pre>
$module

$import $avEventGen (); // must import this built-in module

list onOwnerSay(string key, string message) {
    return [mkTouch(key, 1.0)]; // touch the prim for 1 second
}

list onChat(string name, string key, string message) {
	return [mkPay(key, 5),mkSay(0,"hello")]; // pay a prim, say "hello"
}
</pre>
</code>

The above module causes touch events to occur when "llOwnerSay" messages are heard by the avatar, and
causes the avatar to pay a prim and say &quot;hello&quot; when any chat is heard.
</body>

